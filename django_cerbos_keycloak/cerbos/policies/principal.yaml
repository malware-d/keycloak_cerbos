# ========================================
# PRINCIPAL POLICY: john_doe (Marketing Specialist)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "john_doe"
  rules:
    # Can approve Marketing department documents with specific conditions
    - resource: document
      actions:
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.department == 'Marketing'
                  - expr: request.resource.attr.status == 'pending_approval'
                  - expr: request.resource.attr.project_budget <= 25000

    # Can view all Marketing documents regardless of status
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.department == 'Marketing'

    # Special permission to edit brand-related documents
    - resource: document
      actions:
        - action: "edit"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.content_type == 'brand_document'
                  - expr: request.resource.attr.classification != 'confidential'

---
# ========================================
# PRINCIPAL POLICY: finance_manager (Finance Department Manager)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "finance_manager"
  rules:
    # Full control over Finance department documents
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW
        - action: "edit" 
          effect: EFFECT_ALLOW
        - action: "approve"
          effect: EFFECT_ALLOW
        - action: "reject"
          effect: EFFECT_ALLOW
      condition:
        match:
          expr: request.resource.attr.department == 'Finance'

    # Can approve high-value documents (executive privilege)
    - resource: document
      actions:
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.project_budget <= 500000
                  - expr: request.resource.attr.is_financial == true

    # Can delete old financial reports
    - resource: document
      actions:
        - action: "delete"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.department == 'Finance'
                  - expr: request.resource.attr.content_type == 'financial_report'
                  - expr: request.resource.attr.status != 'approved'

---
# ========================================
# PRINCIPAL POLICY: security_auditor (Compliance & Security)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "security_auditor"
  rules:
    # Read-only access to all documents for auditing purposes
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW

    # Can approve security policies and compliance documents
    - resource: document
      actions:
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              any:
                of:
                  - expr: request.resource.attr.content_type == 'security_policy'
                  - expr: request.resource.attr.content_type == 'compliance_document'

    # Can reject any document that violates security policies
    - resource: document
      actions:
        - action: "reject"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.classification in ['confidential', 'restricted']

---
# ========================================
# PRINCIPAL POLICY: project_manager (Cross-Department Project Manager)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "project_manager"
  rules:
    # Can view documents from multiple departments for project coordination
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW
          condition:
            match:
              any:
                of:
                  - expr: request.resource.attr.department in ['Marketing', 'IT', 'HR']
                  - expr: request.resource.attr.classification == 'public'

    # Can edit project-related documents
    - resource: document
      actions:
        - action: "edit"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.project_budget <= 75000
                  - expr: request.resource.attr.status in ['draft', 'pending_approval']

    # Can approve low-value cross-departmental documents
    - resource: document
      actions:
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.project_budget <= 15000
                  - expr: request.resource.attr.classification in ['internal', 'public']
                  - expr: request.resource.attr.author != request.principal.id

---
# ========================================
# PRINCIPAL POLICY: intern_user (Limited Access Intern)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "intern_user"
  rules:
    # Can only view public documents
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.classification == 'public'
                  - expr: request.resource.attr.status == 'approved'

    # Can edit their own draft documents only
    - resource: document
      actions:
        - action: "edit"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.author == request.principal.id
                  - expr: request.resource.attr.status == 'draft'
                  - expr: request.resource.attr.classification == 'public'

    # Explicitly denied access to confidential or financial documents
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_DENY
          condition:
            match:
              any:
                of:
                  - expr: request.resource.attr.classification in ['confidential', 'restricted']
                  - expr: request.resource.attr.is_financial == true
                  - expr: request.resource.attr.project_budget > 5000

---
# ========================================
# PRINCIPAL POLICY: external_consultant (Limited External Access)
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "external_consultant"
  rules:
    # Can only view specific project documents they're assigned to
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.classification == 'public'
                  - expr: request.resource.attr.content_type in ['project_plan', 'marketing_material']
                  - expr: request.resource.attr.status == 'approved'

    # Time-restricted access (would need to implement time checks in real scenario)
    - resource: document
      actions:
        - action: "edit"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.author == request.principal.id
                  - expr: request.resource.attr.classification == 'public'
                  - expr: request.resource.attr.status == 'draft'
                  # In real implementation: check if current date is within contract period

    # Explicitly denied access to internal operations
    - resource: document
      actions:
        - action: "view"
          effect: EFFECT_DENY
          condition:
            match:
              any:
                of:
                  - expr: request.resource.attr.department in ['Finance', 'HR']
                  - expr: request.resource.attr.content_type in ['financial_report', 'security_policy']
                  - expr: request.resource.attr.classification in ['confidential', 'restricted']




# apiVersion: api.cerbos.dev/v1
# principalPolicy:
#   version: default
#   principal: "john_doe"
#   rules:
#     - resource: document
#       actions:
#         - action: "approve"
#           effect: EFFECT_ALLOW
#           condition:
#             match:
#               all:
#                 of:
#                   - expr: request.resource.attr.department == 'Marketing'
#                   - expr: request.resource.attr.status == 'pending_approval'