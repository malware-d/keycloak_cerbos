# ========================================
# finance_manager.yaml - FIXED
# ========================================
apiVersion: api.cerbos.dev/v1
principalPolicy:
  version: default
  principal: "finance_manager"
  rules:
    - resource: document
      actions:
        # Full control over Finance department documents - view
        - action: "view"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.department == 'Finance'
          name: finance_manager_view_dept_docs
              
        # Full control over Finance department documents - edit
        - action: "edit"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.department == 'Finance'
          name: finance_manager_edit_dept_docs
              
        # Full control over Finance department documents - approve
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.department == 'Finance'
          name: finance_manager_approve_dept_docs
              
        # Full control over Finance department documents - reject
        - action: "reject"
          effect: EFFECT_ALLOW
          condition:
            match:
              expr: request.resource.attr.department == 'Finance'
          name: finance_manager_reject_dept_docs

        # Can approve high-value documents (executive privilege)
        - action: "approve"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.project_budget <= 500000
                  - expr: request.resource.attr.is_financial == true
          name: finance_manager_approve_high_value

        # Can delete old financial reports
        - action: "delete"
          effect: EFFECT_ALLOW
          condition:
            match:
              all:
                of:
                  - expr: request.resource.attr.department == 'Finance'
                  - expr: request.resource.attr.content_type == 'financial_report'
                  - expr: request.resource.attr.status != 'approved'
          name: finance_manager_delete_old_reports